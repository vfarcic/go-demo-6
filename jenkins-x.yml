buildPack: go
pipelineConfig:
  agent: {}
  pipelines:
    pullRequest:
      env:
      - name: NAMESPACE
        value: cd-$REPO_OWNER-go-demo-6-$BRANCH_NAME
      build:
        preSteps:
        - sh: make unittest
      promote:
        steps:
        - sh: env
        - sh: kubectl -n $NAMESPACE rollout status deployment preview-preview
        - sh: ADDRESS=`jx get preview --current 2>&1` make functest
